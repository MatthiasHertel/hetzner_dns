---
- hosts: localhost
  connection: local
  gather_facts: no

  vars:
    TEST_ZONE: hetzner_dns.osuv.de

  tasks:
    - name: fetch all zone infos
      markuman.hetzner_dns.zone_info:
      register: ZONES

    - name: fetch zone info
      markuman.hetzner_dns.zone_info:
        name: "{{ TEST_ZONE }}"
      register: ZONES

    
    - name: add record
      markuman.hetzner_dns.record:
        zone_id: "{{ ZONES.zone_id }}"
        name: hetzner_dns_ansible_collection
        value: osuv.de.
        type: CNAME
        ttl: 300
      register: RECORD

    - name: fetch record info
      markuman.hetzner_dns.record_info:
        filter:
          - name: hetzner_dns_ansible_collection
            type: CNAME
        zone_name: osuv.de

    - name: add record no change
      markuman.hetzner_dns.record:
        zone_name: "{{ TEST_ZONE }}"
        name: hetzner_dns_ansible_collection
        value: osuv.de.
        type: CNAME
        ttl: 300
      register: RECORD

    - name: add record change
      markuman.hetzner_dns.record:
        zone_name: "{{ TEST_ZONE }}"
        name: hetzner_dns_ansible_collection
        value: osuv.de.
        type: CNAME
        ttl: 60
      register: RECORD

    - name: del record
      markuman.hetzner_dns.record:
        zone_name: "{{ TEST_ZONE }}"
        name: hetzner_dns_ansible_collection
        type: CNAME
        state: absent
      register: RECORD

    - name: del record no change
      markuman.hetzner_dns.record:
        zone_name: "{{ TEST_ZONE }}"
        name: hetzner_dns_ansible_collection
        type: CNAME
        state: absent
      register: RECORD
